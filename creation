#!/bin/bash

if [ $# -ne 3 ]
then
    echo "Usage: container_name, profile number, config number"
    exit 1
fi

con_name=$1
profile=$2
config=$3
timestamp="$(date +%s)"
target_con_new="${target_con}-${config_num}-${timestamp}"



#con_IP=$(sudo lxc exec $con_name -- hostname -I)

# starts containe
#sudo lxc launch ubuntu:20.04 -p $profile $con_name #> /dev/null

if [ "$config" == 1 ]; then
    sudo lxc launch c1_image -p $profile $con_name
  elif [ "$config" == 2 ]; then 
    sudo lxc launch c2_image -p $profile $con_name 
  elif [ "$config" == 3 ]; then
    sudo lxc launch c3_image -p $profile $con_name
fi
sleep 10
sudo lxc exec $con_name -- sudo apt-get update
sudo lxc exec $con_name -- sudo apt-get install -y openssh-server
sudo lxc exec $con_name -- sudo ssh-keygen -A
sudo lxc exec $con_name -- sudo sed -i "s/#PermitRootLogin prohibit-password/PermitRootLogin yes/" /etc/ssh/sshd_config
sudo lxc exec $con_name -- sudo sed -i "s/#PasswordAuthentication no/PasswordAuthentication yes/" /etc/ssh/sshd_config
sudo lxc exec $con_name -- sudo sed -i "s/PasswordAuthentication no/PasswordAuthentication yes/" /etc/ssh/sshd_config.d/60-cloudimg-settings.conf
sudo lxc exec $con_name -- sudo systemctl restart ssh

#Office of Student Financial Aid
 # if [ "$config" == 1 ]; then
    #   sudo cp -r /home/aces/Bumblebees/1/* /root/containers/$con_name/rootfs/home/
#Office of the Registrar
 # elif [ "$config" == 2 ]; then
     # sudo cp -r /home/aces/Bumblebees/2/* /root/containers/$con_name/rootfs/home/
#Office of Computer Science
#  else
   #   sudo cp -r /home/aces/Bumblebees/3/* /root/containers/$con_name/rootfs/home/
#fi

sudo screen -dmS "mitm_${con_name}" node /root/honeypots/MITM/mitm/index.js "${con_name}.js"


