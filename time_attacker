#!/bin/bash
# time_attacker (fixed)

if [ $# -ne 2 ]; then
  echo "Usage: container_name timestamp"
  exit 1
fi


con_name=$1
timestamp=$2
sleep 1m
auth_log="/root/containers/${con_name}/rootfs/var/log/auth.log"
mitm_log="/home/aces/Bumblebees/${con_name}_logs/${con_name}_${timestamp}.log"

# look for the MITM log marker that shows attacker left
attacker_left=$(grep -F "Attacker closed connection" "$mitm_log" 2>/dev/null || true)

# if attacker hasn't left then kick them out
if [ -z "$attacker_left" ]; then
   sudo echo "Attacker timed out" >> $auth_log
fi

